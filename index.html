<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoneToken Mining Hub</title>
    <link rel="icon" type="image/png" href="images/none.png">
    <!-- å¼•å…¥ Font Awesome å›¾æ ‡åº“ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Arial', sans-serif;
            background: #2C2F54;
            color: #fff;
            line-height: 1.4;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        .header {
            background: #2C2F54;
            padding: 10px 0;
            text-align: center;
            width: 100%;
        }
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            background: #1E213D;
            height: 40px;
        }
        .header-top .balance {
            font-size: 1.1em;
            color: #F4A261;
        }
        .header-top .actions {
            display: flex;
            gap: 10px;
        }
        .language-switcher, .action-btn {
            background: #34495E;
            color: #fff;
            border: none;
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 0.8em;
            cursor: pointer;
        }
        .action-btn i {
            font-size: 1em;
        }
        .header-content {
            padding: 20px 0;
        }
        .header-content h1 {
            font-size: 1.5em;
            color: #F4A261;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        .header-content h2 {
            font-size: 0.9em;
            color: #A8B5D4;
            margin-bottom: 10px;
        }
        .miner-gif {
            width: 80px;
            height: 80px;
            background: url('images/Miner.png') no-repeat center;
            background-size: contain;
            margin: 0 auto 10px;
        }
        .miner-prompt {
            font-size: 0.8em;
            color: #F4A261;
            text-align: center;
            margin-bottom: 10px;
            animation: fade 3s infinite;
        }
        @keyframes fade {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        .container {
            width: 100%;
            max-width: 400px;
            padding: 0 10px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .section {
            background: #2C3E50;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            text-align: center;
        }
        .section-title {
            font-size: 1.1em;
            color: #F4A261;
            margin-bottom: 10px;
        }
        .button-group {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        button {
            background: #F4A261;
            color: #fff;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s;
        }
        button:hover {
            background: #E07A5F;
        }
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin: 10px 0;
        }
        input {
            padding: 8px;
            border: none;
            border-radius: 10px;
            background: #34495E;
            color: #fff;
            font-size: 0.9em;
            text-align: center;
        }
        input:focus {
            outline: none;
            box-shadow: 0 0 3px #F4A261;
        }
        .percentage-buttons {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 10px 0;
        }
        .percentage-btn {
            background: #F4A261;
            color: #fff;
            border: none;
            padding: 6px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            cursor: pointer;
            transition: background 0.3s;
        }
        .percentage-btn:hover {
            background: #E07A5F;
        }
        .info-panel {
            background: #34495E;
            padding: 10px;
            border-radius: 10px;
            margin-top: 10px;
            font-size: 0.8em;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: #2C3E50;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            color: #fff;
            max-width: 300px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        .modal-content p {
            margin-bottom: 15px;
            font-size: 1em;
        }
        .modal-content button {
            background: #F4A261;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }
        footer {
            background: #1E2A44;
            text-align: center;
            padding: 10px;
            width: 100%;
            color: #A8B5D4;
            font-size: 0.8em;
        }
        @media (max-width: 480px) {
            .header-content h1 { font-size: 1.3em; }
            .miner-gif { width: 60px; height: 60px; }
            button { padding: 6px 12px; font-size: 0.8em; }
            input { font-size: 0.8em; }
            .miner-prompt { font-size: 0.7em; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-top">
            <span id="noneBalance">0 NONE</span>
            <div class="actions">
                <button class="action-btn" onclick="window.open('https://twitter.com', '_blank')"><i class="fab fa-twitter"></i></button>
                <button class="action-btn" onclick="window.open('https://telegram.org', '_blank')"><i class="fab fa-telegram-plane"></i></button>
                <select class="language-switcher" id="languageSwitcher">
                    <option value="en">EN</option>
                    <option value="zh">ZH</option>
                    <option value="ja">JA</option>
                </select>
            </div>
        </div>
        <div class="header-content">
            <h1 id="title">NoneToken Mining Hub</h1>
            <h2 id="subtitle">February 20, 2025</h2>
            <div class="miner-gif"></div>
            <div class="miner-prompt" id="minerPrompt"></div>
        </div>
    </div>
    <div class="container">
        <div class="section">
            <div class="section-title" id="connectTitle">Connect Wallet</div>
            <div class="button-group">
                <button id="connectButton">Connect</button>
            </div>
            <div id="walletStatus" class="info-panel">Wallet: Not Connected</div>
        </div>
        <div class="section">
            <div class="section-title" id="joinTitle">Join Network</div>
            <div class="button-group">
                <button id="joinWithReferrerButton">Join (10 BONE)</button>
            </div>
            <div class="input-group">
                <input type="text" id="referrerInput" placeholder="Referrer Address">
            </div>
            <div id="joinInfo" class="info-panel"></div>
        </div>
        <div class="section">
            <div class="section-title" id="nodeTitle">Become a Node</div>
            <div class="button-group">
                <button id="becomeNodeButton">Node (1000 BONE)</button>
            </div>
            <div id="nodeInfo" class="info-panel"></div>
        </div>
        <div class="section">
            <div class="section-title" id="stakeTitle">Stake NONE</div>
            <div class="button-group">
                <button id="stakeButton">Stake</button>
                <button id="withdrawStakeButton">Withdraw</button>
            </div>
            <div class="input-group">
                <input type="text" id="nodeIdInput" placeholder="Node ID (1-2100)">
                <input type="text" id="stakeAmountInput" placeholder="Amount (Min 10000 NONE)">
            </div>
            <div class="percentage-buttons">
                <button class="percentage-btn" onclick="setStakePercentage(25)">25%</button>
                <button class="percentage-btn" onclick="setStakePercentage(50)">50%</button>
                <button class="percentage-btn" onclick="setStakePercentage(75)">75%</button>
                <button class="percentage-btn" onclick="setStakePercentage(100)">100%</button>
            </div>
            <div id="stakeInfo" class="info-panel"></div>
        </div>
    </div>
    <footer id="footer">Powered by Shibarium Â© 2025</footer>

    <div id="modal" class="modal">
        <div class="modal-content">
            <p id="modalMessage"></p>
            <button onclick="closeModal()">OK</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/web3@1.7.0/dist/web3.min.js"></script>
    <script>
        let web3, accounts, contract;
        const contractAddress = "0x64E19b6a167878d2483d166212A3c2c68b1eB842";
        const contractABI = /* [Your ABI here, same as original] */;
        const shibariumMainnet = {
            chainId: 109,
            chainName: 'Shibarium',
            nativeCurrency: { name: 'BONE', symbol: 'BONE', decimals: 18 },
            rpcUrls: ['https://www.shibrpc.com'],
            blockExplorerUrls: ['https://shibariumscan.io'],
        };

        const translations = {
            en: {
                title: "NoneToken Mining Hub",
                subtitle: "February 20, 2025",
                connectTitle: "Connect Wallet",
                walletStatus: "Wallet: Not Connected",
                joinTitle: "Join Network",
                joinButton: "Join (10 BONE)",
                referrerPlaceholder: "Referrer Address",
                nodeTitle: "Become a Node",
                nodeButton: "Node (1000 BONE)",
                stakeTitle: "Stake NONE",
                stakeButton: "Stake",
                withdrawButton: "Withdraw",
                nodeIdPlaceholder: "Node ID (1-2100)",
                amountPlaceholder: "Amount (Min 10000 NONE)",
                footer: "Powered by Shibarium Â© 2025",
                connectPrompt: "Connecting to your wallet... â›ï¸",
                connectError: "Connection failed: ",
                joinPrompt: "Joining network with 10 BONE... ðŸ’Ž",
                joinError: "Join failed: ",
                joinSuccess: "Joined successfully! Start mining! ðŸš€",
                nodePrompt: "Upgrading to node with 1000 BONE... âš™ï¸",
                nodeError: "Node upgrade failed: ",
                nodeSuccess: "Upgraded to node! You're a mining boss! ðŸŽ‰",
                stakePrompt: "Staking {amount} NONE to Node {nodeId}... â›ï¸",
                stakeError: "Staking failed: ",
                stakeSuccess: "Staked {amount} NONE to Node {nodeId}! ðŸ’°",
                withdrawPrompt: "Withdrawing your stake... ðŸ’¸",
                withdrawError: "Withdrawal failed: ",
                withdrawSuccess: "Stake withdrawn with rewards! ðŸŽŠ",
                connectFirst: "Please connect your wallet first! ðŸ”§",
                nodeIdDisplay: "Your Node ID: ",
                referralCount: "Referrals: ",
                prompts: [
                    "â›ï¸ Miner, ready your pickaxe! Let's dig some NONE!",
                    "ðŸ’Ž Found any NONE yet? Keep mining, champ!",
                    "âš¡ Power up your rig! NONE awaits you!",
                    "ðŸš€ Blast off to the NONE mines! Go go go!",
                    "ðŸ”¥ Hot streak! Dig deeper for more NONE!",
                    "ðŸ’° Jackpot time! Stake more to win big!",
                    "â›ï¸ Swing that pickaxe! NONE is calling!",
                    "ðŸŒŸ Shine bright, miner! NONE is your gem!",
                    "âš™ï¸ Gear up! The NONE mines are open!",
                    "ðŸŽ‰ Party in the mines! Dig for NONE now!"
                ]
            },
            zh: {
                title: "NoneToken æŒ–çŸ¿ä¸­å¿ƒ",
                subtitle: "2025å¹´2æœˆ20æ—¥",
                connectTitle: "è¿žæŽ¥é’±åŒ…",
                walletStatus: "é’±åŒ…: æœªè¿žæŽ¥",
                joinTitle: "åŠ å…¥ç½‘ç»œ",
                joinButton: "åŠ å…¥ (10 BONE)",
                referrerPlaceholder: "æŽ¨èäººåœ°å€",
                nodeTitle: "æˆä¸ºèŠ‚ç‚¹",
                nodeButton: "èŠ‚ç‚¹ (1000 BONE)",
                stakeTitle: "è´¨æŠ¼ NONE",
                stakeButton: "è´¨æŠ¼",
                withdrawButton: "æ’¤å›ž",
                nodeIdPlaceholder: "èŠ‚ç‚¹ ID (1-2100)",
                amountPlaceholder: "æ•°é‡ (æœ€å° 10000 NONE)",
                footer: "ç”± Shibarium é©±åŠ¨ Â© 2025",
                connectPrompt: "è¿žæŽ¥é’±åŒ…ä¸­... â›ï¸",
                connectError: "è¿žæŽ¥å¤±è´¥: ",
                joinPrompt: "ç”¨10 BONEåŠ å…¥ç½‘ç»œ... ðŸ’Ž",
                joinError: "åŠ å…¥å¤±è´¥: ",
                joinSuccess: "åŠ å…¥æˆåŠŸï¼å¼€å§‹æŒ–çŸ¿ï¼ðŸš€",
                nodePrompt: "ç”¨1000 BONEå‡çº§ä¸ºèŠ‚ç‚¹... âš™ï¸",
                nodeError: "èŠ‚ç‚¹å‡çº§å¤±è´¥: ",
                nodeSuccess: "å‡çº§ä¸ºèŠ‚ç‚¹ï¼ä½ æ˜¯æŒ–çŸ¿å¤§ä½¬ï¼ðŸŽ‰",
                stakePrompt: "å°† {amount} NONE è´¨æŠ¼åˆ°èŠ‚ç‚¹ {nodeId}... â›ï¸",
                stakeError: "è´¨æŠ¼å¤±è´¥: ",
                stakeSuccess: "å·²å°† {amount} NONE è´¨æŠ¼åˆ°èŠ‚ç‚¹ {nodeId}ï¼ðŸ’°",
                withdrawPrompt: "æ’¤å›žè´¨æŠ¼ä¸­... ðŸ’¸",
                withdrawError: "æ’¤å›žå¤±è´¥: ",
                withdrawSuccess: "è´¨æŠ¼å·²æ’¤å›žï¼Œå¸¦å¥–åŠ±ï¼ðŸŽŠ",
                connectFirst: "è¯·å…ˆè¿žæŽ¥é’±åŒ…ï¼ðŸ”§",
                nodeIdDisplay: "ä½ çš„èŠ‚ç‚¹ ID: ",
                referralCount: "é‚€è¯·äººæ•°: ",
                prompts: [
                    "â›ï¸ çŸ¿å·¥ï¼Œå‡†å¤‡å¥½ä½ çš„é•ï¼å¼€æŒ– NONE å§ï¼",
                    "ðŸ’Ž æŒ–åˆ° NONE äº†å—ï¼Ÿç»§ç»­åŠªåŠ›ï¼Œå† å†›ï¼",
                    "âš¡ ç»™ä½ çš„çŸ¿æœºåŠ ç”µï¼NONE åœ¨ç­‰ä½ ï¼",
                    "ðŸš€ å†²å‘ NONE çŸ¿åœºï¼å¿«å¿«å¿«ï¼",
                    "ðŸ”¥ çƒ­ç«æœå¤©ï¼æŒ–æ·±ç‚¹æ‹¿æ›´å¤š NONEï¼",
                    "ðŸ’° å¤§å¥–æ—¶åˆ»ï¼å¤šè´¨æŠ¼èµ¢å¤§å¥–ï¼",
                    "â›ï¸ æŒ¥åŠ¨ä½ çš„é•ï¼NONE åœ¨å¬å”¤ï¼",
                    "ðŸŒŸ é—ªè€€å§ï¼ŒçŸ¿å·¥ï¼NONE æ˜¯ä½ çš„å®çŸ³ï¼",
                    "âš™ï¸ è£…å¤‡å¥½ï¼NONE çŸ¿åœºå·²å¼€æ”¾ï¼",
                    "ðŸŽ‰ çŸ¿åœºæ´¾å¯¹ï¼çŽ°åœ¨å°±æŒ– NONE å§ï¼"
                ]
            },
            ja: {
                title: "NoneToken ãƒžã‚¤ãƒ‹ãƒ³ã‚°ãƒãƒ–",
                subtitle: "2025å¹´2æœˆ20æ—¥",
                connectTitle: "ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã‚’æŽ¥ç¶š",
                walletStatus: "ã‚¦ã‚©ãƒ¬ãƒƒãƒˆ: æœªæŽ¥ç¶š",
                joinTitle: "ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å‚åŠ ",
                joinButton: "å‚åŠ  (10 BONE)",
                referrerPlaceholder: "ç´¹ä»‹è€…ã‚¢ãƒ‰ãƒ¬ã‚¹",
                nodeTitle: "ãƒŽãƒ¼ãƒ‰ã«ãªã‚‹",
                nodeButton: "ãƒŽãƒ¼ãƒ‰ (1000 BONE)",
                stakeTitle: "NONEã‚’ã‚¹ãƒ†ãƒ¼ã‚¯",
                stakeButton: "ã‚¹ãƒ†ãƒ¼ã‚¯",
                withdrawButton: "å¼•ãå‡ºã—",
                nodeIdPlaceholder: "ãƒŽãƒ¼ãƒ‰ ID (1-2100)",
                amountPlaceholder: "æ•°é‡ (æœ€å° 10000 NONE)",
                footer: "Shibarium æä¾› Â© 2025",
                connectPrompt: "ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã«æŽ¥ç¶šä¸­... â›ï¸",
                connectError: "æŽ¥ç¶šå¤±æ•—: ",
                joinPrompt: "10 BONEã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å‚åŠ ä¸­... ðŸ’Ž",
                joinError: "å‚åŠ å¤±æ•—: ",
                joinSuccess: "å‚åŠ æˆåŠŸï¼ãƒžã‚¤ãƒ‹ãƒ³ã‚°é–‹å§‹ï¼ðŸš€",
                nodePrompt: "1000 BONEã§ãƒŽãƒ¼ãƒ‰ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ä¸­... âš™ï¸",
                nodeError: "ãƒŽãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å¤±æ•—: ",
                nodeSuccess: "ãƒŽãƒ¼ãƒ‰ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ï¼ãƒžã‚¤ãƒ‹ãƒ³ã‚°ãƒœã‚¹ï¼ðŸŽ‰",
                stakePrompt: "{amount} NONEã‚’ãƒŽãƒ¼ãƒ‰ {nodeId} ã«ã‚¹ãƒ†ãƒ¼ã‚¯ä¸­... â›ï¸",
                stakeError: "ã‚¹ãƒ†ãƒ¼ã‚¯å¤±æ•—: ",
                stakeSuccess: "{amount} NONEã‚’ãƒŽãƒ¼ãƒ‰ {nodeId} ã«ã‚¹ãƒ†ãƒ¼ã‚¯ã—ã¾ã—ãŸï¼ðŸ’°",
                withdrawPrompt: "ã‚¹ãƒ†ãƒ¼ã‚¯ã‚’å¼•ãå‡ºã—ä¸­... ðŸ’¸",
                withdrawError: "å¼•ãå‡ºã—å¤±æ•—: ",
                withdrawSuccess: "ã‚¹ãƒ†ãƒ¼ã‚¯ãŒå ±é…¬ã¨ä¸€ç·’ã«å¼•ãå‡ºã•ã‚Œã¾ã—ãŸï¼ðŸŽŠ",
                connectFirst: "ã¾ãšã‚¦ã‚©ãƒ¬ãƒƒãƒˆã‚’æŽ¥ç¶šã—ã¦ãã ã•ã„ï¼ðŸ”§",
                nodeIdDisplay: "ã‚ãªãŸã®ãƒŽãƒ¼ãƒ‰ ID: ",
                referralCount: "ç´¹ä»‹äººæ•°: ",
                prompts: [
                    "â›ï¸ ãƒžã‚¤ãƒŠãƒ¼ã€ã¤ã‚‹ã¯ã—ã‚’æº–å‚™ï¼NONEã‚’æŽ˜ã‚ã†ï¼",
                    "ðŸ’Ž NONEã¯è¦‹ã¤ã‹ã£ãŸï¼Ÿé ‘å¼µã‚Œã€ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³ï¼",
                    "âš¡ ãƒžã‚¤ãƒ‹ãƒ³ã‚°ãƒªã‚°ã«é›»åŠ›æ³¨å…¥ï¼NONEãŒå¾…ã£ã¦ã‚‹ï¼",
                    "ðŸš€ NONEé‰±å±±ã¸å‡ºç™ºï¼æ€¥ã’æ€¥ã’ï¼",
                    "ðŸ”¥ ç†±ã„ãžï¼ã‚‚ã£ã¨æ·±ãæŽ˜ã£ã¦NONEã‚²ãƒƒãƒˆï¼",
                    "ðŸ’° å¤§å½“ãŸã‚Šï¼ã‚‚ã£ã¨ã‚¹ãƒ†ãƒ¼ã‚¯ã—ã¦å¤§å‹åˆ©ï¼",
                    "â›ï¸ ã¤ã‚‹ã¯ã—ã‚’æŒ¯ã‚Œï¼NONEãŒå‘¼ã‚“ã§ã‚‹ï¼",
                    "ðŸŒŸ è¼ã‘ã€ãƒžã‚¤ãƒŠãƒ¼ï¼NONEã¯å›ã®å®çŸ³ã ï¼",
                    "âš™ï¸ è£…å‚™ã‚’æ•´ãˆã‚ˆã†ï¼NONEé‰±å±±ãŒé–‹ã„ãŸï¼",
                    "ðŸŽ‰ é‰±å±±ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ï¼ä»Šã™ãNONEã‚’æŽ˜ã‚ã†ï¼"
                ]
            }
        };

        let currentLang = 'en';
        let promptIndex = 0;

        function updateLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            document.getElementById('title').innerText = t.title;
            document.getElementById('subtitle').innerText = t.subtitle;
            document.getElementById('connectTitle').innerText = t.connectTitle;
            document.getElementById('walletStatus').innerText = contract ? `Wallet: ${accounts[0].slice(0, 6)}...${accounts[0].slice(-4)}` : t.walletStatus;
            document.getElementById('joinTitle').innerText = t.joinTitle;
            document.getElementById('joinWithReferrerButton').innerText = t.joinButton;
            document.getElementById('referrerInput').placeholder = t.referrerPlaceholder;
            document.getElementById('nodeTitle').innerText = t.nodeTitle;
            document.getElementById('becomeNodeButton').innerText = t.nodeButton;
            document.getElementById('stakeTitle').innerText = t.stakeTitle;
            document.getElementById('stakeButton').innerText = t.stakeButton;
            document.getElementById('withdrawStakeButton').innerText = t.withdrawButton;
            document.getElementById('nodeIdInput').placeholder = t.nodeIdPlaceholder;
            document.getElementById('stakeAmountInput').placeholder = t.amountPlaceholder;
            document.getElementById('footer').innerText = t.footer;
            updatePrompt();
            updateNoneBalance();
            updateNodeSection();
            updateReferralCount();
        }

        function showModal(message) {
            document.getElementById('modalMessage').innerText = message;
            document.getElementById('modal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        function updatePrompt() {
            const t = translations[currentLang];
            document.getElementById('minerPrompt').innerText = t.prompts[promptIndex];
            promptIndex = (promptIndex + 1) % t.prompts.length;
        }

        setInterval(updatePrompt, 3000); // æ¯ 3 ç§’åˆ‡æ¢æç¤º

        async function connectWallet() {
            const t = translations[currentLang];
            try {
                if (!window.ethereum) throw new Error("No MetaMask detected!");
                showModal(t.connectPrompt);
                web3 = new Web3(window.ethereum);
                accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                const chainId = await web3.eth.getChainId();
                if (chainId !== 109) {
                    try {
                        await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: "0x6d" }] });
                    } catch (e) {
                        if (e.code === 4902) await window.ethereum.request({ method: 'wallet_addEthereumChain', params: [shibariumMainnet] });
                        else throw e;
                    }
                }
                document.getElementById('walletStatus').innerText = `Wallet: ${accounts[0].slice(0, 6)}...${accounts[0].slice(-4)}`;
                contract = new web3.eth.Contract(contractABI, contractAddress);
                updateNoneBalance();
                updateNodeSection();
                updateReferralCount();
            } catch (error) {
                showModal(t.connectError + error.message);
            }
        }

        async function updateNoneBalance() {
            if (!contract) return;
            const balance = await contract.methods.balanceOf(accounts[0]).call();
            document.getElementById('noneBalance').innerText = `${web3.utils.fromWei(balance, "ether")} NONE`;
        }

        async function updateNodeSection() {
            if (!contract) return;
            const [, , isNode] = await contract.methods.getUserStatus(accounts[0]).call();
            const nodeId = await contract.methods.getUserNodeId(accounts[0]).call();
            document.getElementById('becomeNodeButton').style.display = isNode && nodeId > 0 ? 'none' : 'block';
            if (isNode && nodeId > 0) {
                document.getElementById('nodeInfo').innerText = translations[currentLang].nodeIdDisplay + nodeId;
                document.getElementById('nodeInfo').style.display = 'block';
            }
        }

        async function updateReferralCount() {
            if (!contract) return;
            const user = accounts[0];
            const referralInfo = await contract.methods.getReferralInfo(user).call();
            if (referralInfo && referralInfo[0] !== undefined) {
                document.getElementById('joinInfo').innerText = translations[currentLang].referralCount + referralInfo[0];
                document.getElementById('joinInfo').style.display = 'block';
            }
        }

        async function joinWithReferrer() {
            const t = translations[currentLang];
            if (!contract) return showModal(t.connectFirst);
            const referrer = document.getElementById("referrerInput").value;
            if (!referrer) return showModal("Referrer address is required!");
            try {
                showModal(t.joinPrompt);
                await contract.methods.joinWithReferrer(referrer).send({ from: accounts[0], value: web3.utils.toWei("10", "ether") });
                showModal(t.joinSuccess);
                updateReferralCount();
                updateNoneBalance();
                updateNodeSection();
            } catch (error) {
                showModal(t.joinError + error.message);
                document.getElementById("joinInfo").innerHTML = "Failed: " + error.message;
                document.getElementById("joinInfo").style.display = "block";
            }
        }

        async function becomeNode() {
            const t = translations[currentLang];
            if (!contract) return showModal(t.connectFirst);
            try {
                showModal(t.nodePrompt);
                await contract.methods.becomeNode().send({ from: accounts[0], value: web3.utils.toWei("1000", "ether") });
                showModal(t.nodeSuccess);
                updateNodeSection();
                updateNoneBalance();
            } catch (error) {
                showModal(t.nodeError + error.message);
                document.getElementById("nodeInfo").innerHTML = "Failed: " + error.message;
                document.getElementById("nodeInfo").style.display = "block";
            }
        }

        function setStakePercentage(percentage) {
            const t = translations[currentLang];
            if (!web3 || !contract || !accounts) return showModal(t.connectFirst);
            updateNoneBalance().then(() => {
                const balanceText = document.getElementById('noneBalance').innerText.split(' ')[0];
                const balance = parseFloat(balanceText);
                const minUnit = 10000;
                const maxUnits = Math.floor(balance / minUnit);
                if (maxUnits < 1) {
                    document.getElementById('stakeAmountInput').value = 0;
                } else {
                    const units = Math.floor(maxUnits * percentage / 100);
                    document.getElementById('stakeAmountInput').value = units * minUnit;
                }
            });
        }

        async function stakeToNode() {
            const t = translations[currentLang];
            if (!contract) return showModal(t.connectFirst);
            const nodeId = document.getElementById("nodeIdInput").value;
            const amount = document.getElementById("stakeAmountInput").value;
            try {
                showModal(t.stakePrompt.replace('{amount}', amount).replace('{nodeId}', nodeId));
                await contract.methods.stakeToNode(nodeId, web3.utils.toWei(amount, "ether")).send({ from: accounts[0] });
                showModal(t.stakeSuccess.replace('{amount}', amount).replace('{nodeId}', nodeId));
                document.getElementById("stakeInfo").style.display = 'block';
                updateNoneBalance();
            } catch (error) {
                showModal(t.stakeError + error.message);
                document.getElementById("stakeInfo").innerHTML = "Failed: " + error.message;
                document.getElementById("stakeInfo").style.display = 'block';
            }
        }

        async function withdrawStake() {
            const t = translations[currentLang];
            if (!contract) return showModal(t.connectFirst);
            try {
                showModal(t.withdrawPrompt);
                await contract.methods.withdrawStake().send({ from: accounts[0] });
                showModal(t.withdrawSuccess);
                document.getElementById("stakeInfo").style.display = 'block';
                updateNoneBalance();
            } catch (error) {
                showModal(t.withdrawError + error.message);
                document.getElementById("stakeInfo").innerHTML = "Failed: " + error.message;
                document.getElementById("stakeInfo").style.display = 'block';
            }
        }

        document.getElementById('connectButton').addEventListener('click', connectWallet);
        document.getElementById('joinWithReferrerButton').addEventListener('click', joinWithReferrer);
        document.getElementById('becomeNodeButton').addEventListener('click', becomeNode);
        document.getElementById('stakeButton').addEventListener('click', stakeToNode);
        document.getElementById('withdrawStakeButton').addEventListener('click', withdrawStake);
        document.getElementById('languageSwitcher').addEventListener('change', (e) => updateLanguage(e.target.value));

        window.ethereum?.on('chainChanged', connectWallet);
        window.ethereum?.on('accountsChanged', connectWallet);

        updateLanguage('en');
        updatePrompt();
    </script>
</body>
</html>